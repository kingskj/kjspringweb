# 2026-02-28 작업 일지 (h202602281926)

## 정정 메모
- 이전 버전 일지는 배치 작업 위주로만 축약되어, 앞단 핵심 작업(벨리데이션 제거, REST 전환, 화면/권한 수정)이 누락됨.
- 본 문서는 오늘 실제 수행한 흐름 기준으로 보완한 전체 일지.

## 프로젝트 성격 / 운영 조건
- 프로젝트: `kjspringweb` (터틀픽 목적 테스트 시스템)
- 운영 환경: GCP 배포 상태 기준 검증
- 리소스 전제: 2코어 / 1GB 메모리 / 2GB 가상메모리
- DB: H2 유지(변경 없음)

## 1. 안정화 및 기본 방향 반영
1. 소스단 벨리데이션 제거
- 설정 파일이 아닌 소스/화면 로직에서 필수값 체크/화면 검증 로직 제거 방향 반영
- 빈값/이상값은 가능한 서버/DB 제약으로 떨어지게 조정

2. 에러 처리 방향 조정
- 커스텀 에러 로직 구성
- 500 페이지 고정 이동 방식 축소/변경
- 이후 REST 전환 시나리오에 맞춰 500은 페이지 이동 대신 팝업/현 화면 유지 쪽으로 정리

## 2. 게시판/DB 제약 및 요청 방식 변경
1. 게시판 스키마/데이터 제약
- 게시판 제목 컬럼 `NOT NULL` 반영
- 제목 길이 `100` 기준 반영
- 결함 데이터(예: 제목 NULL 게시물) 정리 이슈 대응

2. 요청 처리 방식
- 액티브 요청을 REST 중심으로 전환
- 화면 UX는 기존처럼 보이도록 리다이렉트/후처리 구성
- 에러 발생 시 공통 팝업 노출 정책 반영

## 3. 초기 데이터/재생성 정책 점검
- 기본 데이터는 없을 때만 시드되도록 정리
- 이미 반영된 실제 데이터가 있으면 재생성/재초기화하지 않도록 조정
- 전체 테이블 점검 흐름 반영

## 4. 회원/보안 관련 기능 변경
1. 회원관리 화면
- 비밀번호 항목 노출 추가

2. 사용자 기능
- 로그아웃 영역에 회원정보 수정 페이지 진입 추가
- 회원정보 수정 및 회원탈퇴(해당 row 삭제) 가능하도록 반영

3. 비밀번호 저장 정책(테스트 목적)
- 단방향 암호화 값 외에 원본 비밀번호 컬럼 추가 저장
- 관리자 회원관리 화면에서 원본 표시 가능하도록 반영

## 5. 메뉴관리 강화
1. DB 제약
- 메뉴관리 테이블 컬럼 제약 반영
  - 메뉴명 `NOT NULL`
  - URL `NOT NULL` + `UNIQUE`
  - 순서 `NOT NULL`
  - 상태(노출여부) `NOT NULL`

2. 기능
- 메뉴 추가/삭제 기능 구현
- 리스트 단위 일괄 전송/일괄 처리 방식 반영

3. 화면/검증 정책
- 화면 필수값 벨리데이션 제거
- 상위메뉴 선택에서 `null` 표시를 `-`로 변경
- URL 중복 체크는 클라이언트 사전검증 없이 서버(DB)에 위임
- 중복 시 서버 에러 그대로 발생하도록 정리
- 관리자 좌측 메뉴는 메뉴 변경 시 동적 반영
- 순서 값 `0` 입력 제한 반영

## 6. 게시판 유형/권한 정책
1. 게시판 유형 컬럼 추가
- 유형: `공지사항 / 인사 / 일반`

2. 역할별 동작
- 관리자: 모든 게시물 수정/삭제 가능
- 일반 사용자: 본인 게시물만 수정/삭제 가능
- 일반 사용자도 유형 항목은 보이되 수정 불가, `일반` 고정
- 타인 게시물에서는 유형 선택 불가

3. 오류 수정
- 글쓰기 진입 시 500 발생 이슈 대응

## 7. Spring Batch 구성
1. 배치 구성 방식
- 인사 배치: Tasklet에서 Service 호출해 insert
- 삭제 배치: Step 기반 처리

2. 배치 목적
- 매일 지정 시각에 인사 게시물 자동 생성
- 매일 지정 시각에 인사 유형 게시물 정리

3. 짝수일 강제 에러 요구 반영
- 삭제 배치 후 날짜(일)가 짝수면 강제 예외 발생 로직 추가

## 8. 스케줄 변경 이력 (오늘)
1. 최초 적용
- 인사: `19:05`
- 삭제: `19:10`

2. 재변경(최종)
- 인사: `19:20` (2개 배치 동시)
- 삭제: `19:22`

## 9. 트랜잭션/롤백 검증 결과
1. 문제 확인
- 스텝 분리 구조에서는 앞 스텝 삭제 커밋 후 다음 스텝 실패 시 롤백 안 됨

2. 수정
- 삭제 + 짝수일 강제에러를 동일 스텝/동일 트랜잭션으로 통합

3. 검증 (2026-02-28, 짝수일)
- `19:20` 인사 배치 2건 `COMPLETED`
- `19:22` 삭제 배치 `FAILED` (강제 예외)
- 로그상 삭제 시도 후 예외 발생
- `/board` 확인 시 인사 게시물 잔존
- 결론: 삭제 트랜잭션 롤백 정상 동작

## 10. 현재 상태
- 서버 기동 상태
- 최종 스케줄: 인사 `19:20`, 삭제 `19:22`
- 짝수일 강제 오류 정책 활성화
- 테스트 시스템 목적(에러 유도/관측) 기준 동작 확인
